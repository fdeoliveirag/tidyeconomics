[
  {
    "path": "posts/2021-02-22-explorando-o-sidra-com-tidyverse-parte-i/",
    "title": "Explorando o SIDRA com tidyverse - Parte I",
    "description": "Esta postagem de abertura integra uma sequência que procurará explorar as bases de dados do SIDRA através de uma abordagem avançada de workflow no R. Neste primeiro episódio, o IPCA por componentes será utilizado para a construção de um gráfico sobre a inflação acumulada no Brasil durante a pandemia, com atenção especial à inflação de alimentos.",
    "author": [
      {
        "name": "Felipe O. Gonçalves",
        "url": {}
      }
    ],
    "date": "2021-02-22",
    "categories": [
      "inflação",
      "SIDRA",
      "dplyr",
      "purrr",
      "forcats",
      "ggplot2"
    ],
    "contents": "\n\nbody{\n  font-size: 14pt;\n  text-align: justify;\n}\ntd{font-size: 16px;}\ncode.r{font-size: 14px;}\npre{font-size: 12px;}\nPara quem ainda não lida com dados do IBGE de maneira sistemática, dificuldades com o SIDRA não são algo incomum. A tentativa de importar as planilhas sob um formato amigável para pesquisa pode trazer dor de cabeça.\nEste blog estreia com a primeira parte de uma sequência de postagens que tentará atenuar essas dificuldades. Na postagem de hoje, utiliza-se a variação mensal do IPCA desagregado em grupos para visualizar a inflação brasileira em tempos de Covid.\nPacotes\n\n\nlibrary(sidrar)    # importação via API\nlibrary(ggthemes)  # estética do gráfico\n#\nlibrary(dplyr)\nlibrary(purrr)\nlibrary(forcats)\nlibrary(ggplot2)\n\n\n\n\nDados\nNão será preciso baixar nenhum arquivo. Seguindo os passos abaixo, encontra-se a expressão que permitirá levar os dados direto para o R:\nAcessar o portal do SIDRA\nIPCA > Relação de Tabelas > 7061\nDefinir opções:\nVariável: variação mensal (%)\nGeral, grupo, subgrupo, item e subitem: 9 componentes\nMês: mar/2020 a jan/2021\nUnidade Territorial: Brasil\n\nArrastar os blocos até ficarem dispostos assim:\n\nMenu Inferior Direito: Links de Compartilhar > Parâmetros para a API\n Feito. Cria-se então um objeto com a expressão (a partir de \"/t\"):\n\n\nt7061 <- \"/t/7061/n1/all/v/306/p/last%2011/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v306%202\"\n\n\n\n E esse objeto é suficiente para importar os dados por meio do providencial {sidrar}:\n\n\ndf_ibge <- sidrar::get_sidra(api = t7061)\n\nnames(df_ibge)\n\n\n [1] \"Nível Territorial (Código)\"                     \n [2] \"Nível Territorial\"                              \n [3] \"Brasil (Código)\"                                \n [4] \"Brasil\"                                         \n [5] \"Variável (Código)\"                              \n [6] \"Variável\"                                       \n [7] \"Mês (Código)\"                                   \n [8] \"Mês\"                                            \n [9] \"Geral, grupo, subgrupo, item e subitem (Código)\"\n[10] \"Geral, grupo, subgrupo, item e subitem\"         \n[11] \"Unidade de Medida (Código)\"                     \n[12] \"Unidade de Medida\"                              \n[13] \"Valor\"                                          \n\n\nManipulação\nDas treze colunas, apenas três serão necessárias aqui:\n\n\nipca <- df_ibge %>%\n  as_tibble() %>%\n  select(\n    date = \"Mês\",\n    component = \"Geral, grupo, subgrupo, item e subitem\",\n    mth_inflation = \"Valor\"\n  )\n\nhead(ipca, 9)\n\n\n# A tibble: 9 x 3\n  date       component                   mth_inflation\n  <chr>      <chr>                               <dbl>\n1 março 2020 1.Alimentação e bebidas              0.84\n2 março 2020 2.Habitação                          0.13\n3 março 2020 3.Artigos de residência             -1.08\n4 março 2020 4.Vestuário                          0.21\n5 março 2020 5.Transportes                       -0.9 \n6 março 2020 6.Saúde e cuidados pessoais          0.21\n7 março 2020 7.Despesas pessoais                 -0.23\n8 março 2020 8.Educação                           0.59\n9 março 2020 9.Comunicação                        0.04\n\nOs dados vêm num padrão “comprido” ao invés de “largo”: não há uma coluna para cada componente, e isso faz com que se tenha nove observações para cada mês. Diante da finalidade desta postagem, o ideal será mantê-los assim.\n O cálculo da inflação acumulada para \\(t \\in \\{1,\\ ..., 11\\}\\) meses de pandemia é recursivo (depende dos próprios valores defasados). De uma variação mensal inicial \\(\\pi_1^{ac} = \\pi_1\\), tem-se\n\\[\\pi_t^{ac} = (1\\ +\\ \\frac{\\pi_t}{100})\\ \\times\\ \\pi_{t-1}^{ac}\\ +\\ \\pi_t\\ \\]\npara \\(t\\neq1\\). Essa atribuição requer a função purrr::accumulate() para ser realizada dentro do flow — em parceria com dplyr::group_by() para ser aplicada a cada componente em separado:\n\n\nipca <- ipca %>%\n  group_by(component) %>%         # agrupamento\n  mutate(\n    # .y\n    accum_inflation = accumulate(\n      mth_inflation,              # .x\n      ~ (1 + .x / 100) * .y + .x  # atribuição recursiva de .y\n    )\n  )\n\n\n\n Conferindo o primeiro e mais relevante componente do período:\n\n\nhead(arrange(ipca, component), 11)\n\n\n# A tibble: 11 x 4\n# Groups:   component [1]\n   date          component               mth_inflation accum_inflation\n   <chr>         <chr>                           <dbl>           <dbl>\n 1 março 2020    1.Alimentação e bebidas          0.84            0.84\n 2 abril 2020    1.Alimentação e bebidas          1.57            2.42\n 3 maio 2020     1.Alimentação e bebidas          0.33            2.76\n 4 junho 2020    1.Alimentação e bebidas          0.64            3.42\n 5 julho 2020    1.Alimentação e bebidas          0.42            3.85\n 6 agosto 2020   1.Alimentação e bebidas          1.17            5.07\n 7 setembro 2020 1.Alimentação e bebidas          2.54            7.74\n 8 outubro 2020  1.Alimentação e bebidas          1.9             9.78\n 9 novembro 2020 1.Alimentação e bebidas          2.28           12.3 \n10 dezembro 2020 1.Alimentação e bebidas          1.37           13.8 \n11 janeiro 2021  1.Alimentação e bebidas          0.68           14.6 \n\n Agora, chega-se ao valor acumulado no final do período para todos os componentes:\n\n\nipca <- ipca %>%\n  summarize(\n    accum_inflation = last(accum_inflation),  # jan/2021\n    .groups = \"drop\"                          # desagrupamento\n  )\n\n\n\n E eis a matéria-prima do gráfico:\n\n\narrange(ipca, desc(accum_inflation))\n\n\n# A tibble: 9 x 2\n  component                   accum_inflation\n  <chr>                                 <dbl>\n1 1.Alimentação e bebidas             14.6   \n2 3.Artigos de residência              7.07  \n3 2.Habitação                          3.98  \n4 9.Comunicação                        3.11  \n5 6.Saúde e cuidados pessoais          1.41  \n6 5.Transportes                        1.36  \n7 7.Despesas pessoais                  0.749 \n8 4.Vestuário                          0.0240\n9 8.Educação                          -2.50  \n\nNota: Ao olhar para a deflação dos serviços educacionais, deve-se ter em conta que fevereiro, um mês particularmente importante para o componente, é o único que não se faz presente nos dados. \nVisualização\nO primeiro passo para o sucesso do gráfico de barras será, seguindo o embalo da formatação, reordenar a sequência de componentes com forcats::fct_reorder() de acordo com o tamanho da inflação acumulada:\n\n\nipca <- ipca %>%\n  mutate(\n    component = component %>%\n      substring(3) %>%                                    # retirada de numeração\n      recode(\"Alimentação e bebidas\" = \"Alimentação\",\n             \"Artigos de residência\" = \"Residência\",\n             \"Saúde e cuidados pessoais\" = \"Saúde\",\n             \"Despesas pessoais\" = \"Desp. Pessoais\") %>%  # concisão\n      fct_reorder(accum_inflation)                        # critério de ordenação\n  )\n\n\n\n A carcaça do gráfico já pode ser criada:\n\n\nipca %>%\n  ggplot(aes(accum_inflation, component)) +\n  geom_col()\n\n\n\n\nPorém ela é pouco apelativa (apesar de ter seu charme). O segundo passo será desfrutar das possibilidades de montagem em cima dessa carcaça — por exemplo, a função ggplot2::geom_label(). Esmiuçá-las exigiria uma postagem à parte.\nPor último, escolhe-se tema e paleta de cores a gosto. Como a inspiração para esta postagem veio justamente de matérias jornalísticas sobre a trajetória recente da inflação de alimentos, foi escolhido um padrão do Wall Street Journal encontrado no {ggthemes}:\n\n\n\nUm senhor ganho de apelo estético.\nNa segunda parte da sequência, será possível trabalhar com planilhas mais complexas do SIDRA. \n###\n\n\n\n",
    "preview": "posts/2021-02-22-explorando-o-sidra-com-tidyverse-parte-i/desmistificando-o-sidra-parte-i_files/figure-html5/unnamed-chunk-12-1.png",
    "last_modified": "2021-02-22T23:55:19-03:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  }
]
